@layer mt.design {
	.grid:not([hidden]) {
		display: grid;
	}
	.flex:not([hidden]) {
		display: flex;
	}
	.grid,
	.flex {
		box-sizing: border-box;
		flex-wrap: wrap;
		gap: var(--ds-size-2);

		& > * {
			box-sizing: border-box;
			margin-block: 0; /* Disable margin on lists, headings, paragraphs etc. */
			min-width: 0; /* https://css-tricks.com/preventing-a-grid-blowout/ */
		}

		&[data-pad="1"] {
			padding: var(--ds-size-1);
		}
		&[data-pad="2"] {
			padding: var(--ds-size-2);
		}
		&[data-pad="3"] {
			padding: var(--ds-size-3);
		}
		&[data-radius="sm"] {
			border-radius: var(--ds-border-radius-sm);
		}
		&[data-radius="md"] {
			border-radius: var(--ds-border-radius-md);
		}
		&[data-radius="lg"] {
			border-radius: var(--ds-border-radius-lg);
		}
		&[data-color] {
			padding: var(--ds-size-3);
			border-radius: 5px; /* TODO: Should it? */
		}
		&[data-color="lys-furu"] {
			background-color: var(--mtds-color-lys-furu);
		}
		&[data-center="sm"],
		&[data-center="md"],
		&[data-center="lg"],
		&[data-center="xl"],
		&[data-center="2xl"] {
			box-sizing: border-box;
			margin-inline: auto;
			width: calc(100% - 10vw); /* Always 5vw padding on each side */
			max-width: 96rem; /* 1440px - default to "2xl" */
		}
		&[data-center="sm"] {
			max-width: 40rem; /* 640px */
		}
		&[data-center="md"] {
			max-width: 48rem; /* 768px */
		}
		&[data-center="lg"] {
			max-width: 64rem; /* 1024px */
		}
		&[data-center="xl"] {
			max-width: 80rem; /* 1280px */
		}
		&[data-center="2xl"] {
			max-width: 96rem; /* 1536px */
		}

		&[data-gap="none"],
		&[data-gap="false"] {
			gap: 0px;
		}
		&[data-gap="xs"] {
			gap: var(--ds-size-1);
		}
		&[data-gap="sm"] {
			gap: var(--ds-size-2);
		}
		&[data-gap="md"] {
			gap: var(--ds-size-4);
		}
		&[data-gap="lg"] {
			gap: var(--ds-size-8);
		}
		&[data-align="start"] {
			align-items: start;
		}
		&[data-align="center"] {
			align-items: center;
		}
		&[data-align="end"] {
			align-items: end;
		}
		&[data-align-content="start"] {
			align-content: start;
		}
		&[data-align-content="center"] {
			align-content: center;
		}
		&[data-align-content="end"] {
			align-content: end;
		}
		&[data-align-content="stretch"] {
			align-content: stretch;
		}
		&[data-align-content="space-around"] {
			align-content: space-around;
		}
		&[data-align-content="space-between"] {
			align-content: space-between;
		}
		&[data-align-content="space-evenly"] {
			align-content: space-evenly;
		}
		&[data-justify="start"] {
			justify-content: start;
		}
		&[data-justify="center"] {
			justify-content: center;
		}
		&[data-justify="end"] {
			justify-content: end;
		}
		&[data-justify="space-around"] {
			justify-content: space-around;
		}
		&[data-justify="space-between"] {
			justify-content: space-between;
		}
		&[data-justify="space-evenly"] {
			justify-content: space-evenly;
		}
		&[data-nowrap] {
			flex-wrap: nowrap;
		}
	}

	.grid {
		--columns: auto-fill;
		--min: 0px;

		&[data-grid] {
			grid-template-columns: repeat(
					var(--columns),
					minmax(min(100%, var(--min)), 1fr)
				);
		}

		&[data-grid|="fit"] {
			--columns: auto-fit;
		}
		&[data-grid="xs"],
		&[data-grid="fit-xs"] {
			--min: 50px; /* TODO: Figure out default sizes */
		}
		&[data-grid="sm"],
		&[data-grid="fit-sm"] {
			--min: 100px;
		}
		&[data-grid="md"],
		&[data-grid="fit-md"] {
			--min: 150px;
		}
		&[data-grid="lg"],
		&[data-grid="fit-lg"] {
			--min: 200px;
		}
		&[data-grid="xl"],
		&[data-grid="fit-xl"] {
			--min: 300px;
		}
		&[data-grid="sidebar"] {
			grid-template-columns: 4fr 8fr; /* TODO: Figure out */
		}
		&[data-grid="1"] {
			--columns: 1;
		}
		&[data-grid="2"] {
			--columns: 2;
		}
		&[data-grid="3"] {
			--columns: 3;
		}
		&[data-grid="4"] {
			--columns: 4;
		}
		&[data-grid="5"] {
			--columns: 5;
		}
		&[data-grid="6"] {
			--columns: 6;
		}
		&[data-grid="7"] {
			--columns: 7;
		}
		&[data-grid="8"] {
			--columns: 8;
		}
		&[data-grid="9"] {
			--columns: 9;
		}
		&[data-grid="10"] {
			--columns: 10;
		}
		&[data-grid="11"] {
			--columns: 11;
		}
		&[data-grid="12"] {
			--columns: 12;
		}

		&[data-grid="app"] {
			--spacing-md: var(--ds-size-6);
			--spacing-sm: var(--ds-size-3);
			--sides--collapsed: calc(var(--ds-size-1) * 17);
			--sides: 14em;

			gap: 0;
			grid-template:
				"header header header" auto
				"nav main aside" 1fr
				"footer footer footer" auto / auto 1fr auto;
			min-height: 100vh;
			min-height: 100svh; /* Use small viewport height if supported */
			transition: grid-template-columns .3s ease-out;

			& > header {
				align-items: center;
				display: flex;
				grid-area: header;
				justify-content: space-between; /* Push logo to left */
				padding: var(--spacing-md) var(--spacing-md) var(--spacing-sm);

				/* Set burger icon on empty <button popovertarget> */
				& button[popovertarget]:empty::before {
					mask-image: var(--mtds-icon-burger);
				}

				/* WIP */
				&[data-color="surface"] {
					background: var(--mtds-color-white);
					border-bottom: 1px solid var(--mtds-color-100);
					padding: var(--spacing-md);
					margin-bottom: var(--spacing-md);
				}
			}
			/* Using this selector to make left side optional and support any tag */
			& > header + :not(main) {
				align-content: start; /* TODO: Set default alignment in case used as grid */
				grid-area: nav;
				overflow-y: auto;
				padding-left: var(--spacing-sm);
				padding-top: var(--spacing-md);
				position: relative;
				view-transition-name: mtds-laytout-app--left;
				width: var(--sides);

				&[data-expanded="false"] [data-expanded="true"],
				&[data-expanded="true"] [data-expanded="false"] {
					display: none;
				}
				&[data-expanded="false"] {
					--mtds-tooltip-position: right;
				}

				/* Position toggle button */
				& > button:first-child {
					all: unset;
					position: absolute;
					inset: 50% 0 auto auto;
					/* border-right: 2px solid; */

					/* &::after {
						content: "<";
					} */
				}

				/* Move tooltips to button content when expanded */
				&:not([data-expanded="false"]) menu > li > [data-tooltip] {
					--mtds-tooltip-position: none;

					&::after {
						content: attr(data-tooltip);
					}
				}

				/* 960px */
				@media screen and (max-width: 60em) {
					& {
						background-color: var(--mtds-color-white);
						border-top: 1px solid var(--mtds-color-100);
						left: 0;
						padding: var(--spacing-sm);
						position: fixed;
						right: 0;
						top: calc(100vh - var(--ds-size-13));
						width: auto;
						z-index: 99;

						&::before {
							content: "Navigasjon";
						}
					}
				}
			}

			& > main {
				container: main / inline-size;
				grid-area: main;
				margin: 0 var(--spacing-sm) var(--spacing-sm);
				view-transition-name: mtds-laytout-app--main;
			}

			/* Using this selector to make right side optional and support any tag */
			& > main + :not(footer) {
				grid-area: aside;
				padding-right: var(--spacing-sm);
				padding-top: var(--spacing-md);
				view-transition-name: mtds-laytout-app--right;
				width: var(--sides);

				&[data-expanded="false"] {
					padding-inline: 0;
					width: 0;
					opacity: 0;
					visibility: hidden;
					overflow: hidden;
				}
			}

			& > footer {
				background: var(--mtds-color-granskog);
				color: var(--mtds-color-lav);
				grid-area: footer;
				margin-top: var(--spacing-sm);
				padding: var(--spacing-md);
			}
		}
	}
}

::view-transition-old(mtds-laytout-app--left),
::view-transition-new(mtds-laytout-app--left),
::view-transition-old(mtds-laytout-app--right),
::view-transition-new(mtds-laytout-app--right) {
	height: 100%;
	object-fit: none;
	object-position: left;
}

::view-transition-old(mtds-laytout-app--main),
::view-transition-new(mtds-laytout-app--main) {
	height: 100%;
}

/* Declare outside @layer to ensure specificity */
.grid[data-grid="app"] > nav[data-expanded="false"] {
	min-width: var(--sides--collapsed) !important; /* Prevent shrinking */
	width: var(--sides--collapsed) !important;
}
